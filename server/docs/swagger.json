{
  "openapi": "3.0.0",
  "info": {
    "title": "Farmer E-Commerce API",
    "version": "1.0.0",
    "description": "API documentation for the Farmer E-Commerce platform."
  },
  "servers": [
    { "url": "/api/v1" }
  ],
  "components": {
    "securitySchemes": {
      "bearerAuth": {
        "type": "http",
        "scheme": "bearer",
        "bearerFormat": "JWT"
      }
    }
  },
  "security": [
    { "bearerAuth": [] }
  ],
  "paths": {
    "/health": {
      "get": {
        "summary": "Health check",
        "responses": {
          "200": {
            "description": "Server is healthy"
          }
        }
      }
    },
    "/auth/register": {
      "post": {
        "summary": "Register buyer or farmer",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "name": { "type": "string" },
                  "email": { "type": "string" },
                  "password": { "type": "string" },
                  "role": { "type": "string", "enum": ["buyer", "farmer"] },
                  "farmName": { "type": "string" },
                  "farmAddress": { "type": "string" },
                  "cropTypes": { "type": "array", "items": { "type": "string" } }
                },
                "required": ["name", "email", "password", "role"]
              }
            }
          }
        },
        "responses": {
          "201": { "description": "Registration successful" },
          "400": { "description": "Email already exists" }
        }
      }
    },
    "/auth/login": {
      "post": {
        "summary": "Login with email and password",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "email": { "type": "string" },
                  "password": { "type": "string" }
                },
                "required": ["email", "password"]
              }
            }
          }
        },
        "responses": {
          "200": { "description": "Login successful" },
          "400": { "description": "Invalid credentials" }
        }
      }
    },
    "/auth/me": {
      "get": {
        "summary": "Get logged-in user profile",
        "security": [{ "bearerAuth": [] }],
        "responses": {
          "200": { "description": "User profile" },
          "401": { "description": "Unauthorized" }
        }
      }
    },
    "/products": {
      "get": {
        "summary": "Get all approved products (with filters)",
        "parameters": [
          { "name": "q", "in": "query", "schema": { "type": "string" }, "description": "Search query" },
          { "name": "category", "in": "query", "schema": { "type": "string" } },
          { "name": "minPrice", "in": "query", "schema": { "type": "number" } },
          { "name": "maxPrice", "in": "query", "schema": { "type": "number" } },
          { "name": "sort", "in": "query", "schema": { "type": "string" }, "description": "Sort by field, e.g. price or -price" }
        ],
        "responses": {
          "200": { "description": "List of products" }
        }
      },
      "post": {
        "summary": "Create product (farmer only)",
        "security": [{ "bearerAuth": [] }],
        "requestBody": {
          "required": true,
          "content": {
            "multipart/form-data": {
              "schema": {
                "type": "object",
                "properties": {
                  "name": { "type": "string" },
                  "description": { "type": "string" },
                  "price": { "type": "number" },
                  "category": { "type": "string" },
                  "stock": { "type": "number" },
                  "image": { "type": "string", "format": "binary" }
                },
                "required": ["name", "price", "category"]
              }
            }
          }
        },
        "responses": {
          "201": { "description": "Product created" },
          "403": { "description": "Farmer not verified" }
        }
      }
    },
    "/products/{id}": {
      "get": {
        "summary": "Get product details",
        "parameters": [
          { "name": "id", "in": "path", "required": true, "schema": { "type": "string" } }
        ],
        "responses": {
          "200": { "description": "Product details" },
          "404": { "description": "Product not found" }
        }
      },
      "put": {
        "summary": "Update own product (farmer only)",
        "security": [{ "bearerAuth": [] }],
        "parameters": [
          { "name": "id", "in": "path", "required": true, "schema": { "type": "string" } }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "multipart/form-data": {
              "schema": {
                "type": "object",
                "properties": {
                  "name": { "type": "string" },
                  "description": { "type": "string" },
                  "price": { "type": "number" },
                  "category": { "type": "string" },
                  "stock": { "type": "number" },
                  "image": { "type": "string", "format": "binary" }
                }
              }
            }
          }
        },
        "responses": {
          "200": { "description": "Product updated" },
          "404": { "description": "Product not found" }
        }
      },
      "delete": {
        "summary": "Delete own product (farmer only)",
        "security": [{ "bearerAuth": [] }],
        "parameters": [
          { "name": "id", "in": "path", "required": true, "schema": { "type": "string" } }
        ],
        "responses": {
          "200": { "description": "Product deleted" },
          "404": { "description": "Product not found" }
        }
      }
    },
    "/cart": {
      "get": {
        "summary": "Get cart of logged-in user (buyer only)",
        "security": [{ "bearerAuth": [] }],
        "responses": {
          "200": { "description": "Cart details" }
        }
      }
    },
    "/cart/add": {
      "post": {
        "summary": "Add/update cart item",
        "security": [{ "bearerAuth": [] }],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "productId": { "type": "string" },
                  "quantity": { "type": "number" }
                },
                "required": ["productId", "quantity"]
              }
            }
          }
        },
        "responses": {
          "200": { "description": "Cart updated" }
        }
      }
    },
    "/cart/update": {
      "patch": {
        "summary": "Update cart item quantity",
        "security": [{ "bearerAuth": [] }],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "productId": { "type": "string" },
                  "quantity": { "type": "number" }
                },
                "required": ["productId", "quantity"]
              }
            }
          }
        },
        "responses": {
          "200": { "description": "Cart updated" }
        }
      }
    },
    "/cart/remove/{productId}": {
      "delete": {
        "summary": "Remove product from cart",
        "security": [{ "bearerAuth": [] }],
        "parameters": [
          { "name": "productId", "in": "path", "required": true, "schema": { "type": "string" } }
        ],
        "responses": {
          "200": { "description": "Product removed from cart" }
        }
      }
    },
    "/cart/clear": {
      "delete": {
        "summary": "Clear whole cart",
        "security": [{ "bearerAuth": [] }],
        "responses": {
          "200": { "description": "Cart cleared" }
        }
      }
    },
    "/orders": {
      "post": {
        "summary": "Place order from cart (buyer only, COD)",
        "security": [{ "bearerAuth": [] }],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "items": {
                    "type": "array",
                    "items": {
                      "type": "object",
                      "properties": {
                        "product": { "type": "string" },
                        "quantity": { "type": "number" }
                      },
                      "required": ["product", "quantity"]
                    }
                  },
                  "shippingAddress": {
                    "type": "object",
                    "properties": {
                      "name": { "type": "string" },
                      "addressLine": { "type": "string" },
                      "city": { "type": "string" },
                      "state": { "type": "string" },
                      "pincode": { "type": "string" },
                      "phone": { "type": "string" }
                    },
                    "required": ["name", "addressLine", "city", "state", "pincode", "phone"]
                  }
                },
                "required": ["items", "shippingAddress"]
              }
            }
          }
        },
        "responses": {
          "201": { "description": "Order placed" }
        }
      },
      "get": {
        "summary": "Get orders (buyer: own, farmer: their products, admin: all)",
        "security": [{ "bearerAuth": [] }],
        "responses": {
          "200": { "description": "List of orders" }
        }
      }
    },
    "/orders/{id}": {
      "get": {
        "summary": "Get order details",
        "security": [{ "bearerAuth": [] }],
        "parameters": [
          { "name": "id", "in": "path", "required": true, "schema": { "type": "string" } }
        ],
        "responses": {
          "200": { "description": "Order details" },
          "404": { "description": "Order not found" }
        }
      },
      "patch": {
        "summary": "Update order status (farmer/admin)",
        "security": [{ "bearerAuth": [] }],
        "parameters": [
          { "name": "id", "in": "path", "required": true, "schema": { "type": "string" } }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "status": { "type": "string", "enum": ["pending", "confirmed", "shipped", "delivered", "cancelled"] }
                },
                "required": ["status"]
              }
            }
          }
        },
        "responses": {
          "200": { "description": "Order updated" },
          "404": { "description": "Order not found" }
        }
      }
    }
  }
}
